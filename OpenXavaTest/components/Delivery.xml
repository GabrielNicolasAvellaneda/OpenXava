<?xml version="1.0" encoding="ISO-8859-1"?>

<!DOCTYPE component SYSTEM "dtds/component.dtd">

<!--
	One example of reference used as key
-->

<component name="Delivery">

	<entity>  
		<!-- It assume 'Invoice' as model (the name of reference with first letter in uppercase) -->
		<reference name="invoice" model="Invoice" key="true"/>
		<reference name="type" model="DeliveryType" key="true"/>
		<property name="number" type="int" key="true"  
			size="6" required="true"/>
		<property name="date" type="java.util.Date" required="true">
			<default-value-calculator class="org.openxava.calculators.CurrentDateCalculator"/>
		</property>	
		<property name="dateAsLabel" type="java.util.Date" stereotype="LABEL">
			<calculator class="org.openxava.calculators.ByPassCalculator">
				<set property="source" from="date"/>
			</calculator>
		</property>
		<property name="description" type="String"/>
		<property name="distance">
			<valid-values>
				<valid-value value="local"/>
				<valid-value value="national"/>				
				<valid-value value="international"/>								
			</valid-values>
		</property>
		<property name="vehicle" type="String" size="15"/>
		<property name="transportMode" type="String" size="20" stereotype="ETIQUETA">
			<calculator class="org.openxava.test.calculators.DeliveryTransportModeCalculator">
				<set property="vehicle"/>
			</calculator>	
		</property>
		<property name="driverType" type="String" size="20"/>
		<reference name="carrier"/>
		<property name="employee" type="String"/>
		<reference name="shipment"/> 
		<property name="remarks" stereotype="MEMO" size="500"/>
		<property name="incidents" stereotype="MEMO" size="500"/>
		
		<finder name="all" arguments="" collection="true"/>
		
		<validator class="org.openxava.test.validators.DeliveryValidator">
			<set property="invoice"/>
		</validator>
							
	</entity>		
	
	<view>
		<property name="deliveredBy">
			<valid-values>      
				<valid-value value="Employee"/>      
				<valid-value value="Carrier"/>      
			</valid-values>  	
			<!-- 
				A calculator that return 0 is like not have,
				but we set for verifying that we can have a calculator and not fail
				-->
			<default-value-calculator class="org.openxava.calculators.IntegerCalculator">				
				<set property="value" value="0"/>
			</default-value-calculator>

		</property>
	
		<property name="advice" type="String" size="40" required="true">
			<default-value-calculator class="org.openxava.test.calculators.AdviceCalculator"/>
		</property>	
		
		<property-view property="number">
			<action action="Deliveries.generateNumber"/>		
		</property-view>
				
		<property-view property="deliveredBy">
			<on-change class="org.openxava.test.actions.OnChangeDeliveryByAction"/>
		</property-view>
		
		<property-view property="distance">
			<on-change class="org.openxava.test.actions.OnChangeDistanceAction"/>
		</property-view>
		
		<property-view property="vehicle">
			<on-change class="org.openxava.test.actions.OnChangeVehicleAction"/>
		</property-view>
		
		
		<property-view property="invoice.number">
			<on-change class="org.openxava.test.actions.OnChangeInvoiceNumberInDeliveryAction"/>
		</property-view>
		
		<property-view property="carrier.number">
			<on-change class="org.openxava.test.actions.OnChangeCarrierInDeliveryAction"/>
		</property-view>
		
		<reference-view reference="invoice" view="Simple"/>	
		<reference-view reference="type">	
			<descriptions-list/>
		</reference-view>
		<reference-view reference="carrier">
			<descriptions-list/>
		</reference-view>
		<reference-view reference="shipment">	
			<descriptions-list/>
		</reference-view>
		
		
		<members>
			invoice;			
			type, number;			
			date;
			description;
			shipment;
			distance, vehicle, transportMode, driverType;
			deliveredBy, carrier, employee;			
			<section name="remarks">advice; remarks</section>
			<section name="incidents">incidents</section>
		</members>

	</view>
	
	<view name="InInvoice">
				
		<members>
			number;
			date;
			type;
			description;			
		</members>
		
	</view>		
	
	<tab>
		<properties>invoice.year, invoice.number, type.number, type.description, number, date, description, distance, dateAsLabel, invoice.sellerDiscount</properties>
	</tab>
	
	<entity-mapping table="XAVATEST@separator@DELIVERY">
		<reference-mapping reference="invoice">
			<reference-mapping-detail 
				column="INVOICE_YEAR" 
				referenced-model-property="year"/> 
			<reference-mapping-detail 
				column="INVOICE_NUMBER" 
				referenced-model-property="number"/> 				
		</reference-mapping>
		<reference-mapping reference="type">
			<reference-mapping-detail 
				column="TYPE" 
				referenced-model-property="number"/> 
		</reference-mapping>					
		<property-mapping
			property="number" column="NUMBER"/>
		
		<multiple-property-mapping property="date">	
			<converter class="org.openxava.converters.Date3Converter"/>	
			<cmp-field converter-property="day" column="DAY" cmp-type="int"/>
			<cmp-field converter-property="month" column="MONTH" cmp-type="int"/>
			<cmp-field converter-property="year" column="YEAR" cmp-type="int"/>			
		</multiple-property-mapping>
		<property-mapping property="distance" column="DISTANCE" cmp-type="String">
			<converter class="org.openxava.converters.ValidValuesLetterConverter">
				<set property="letters" value="LNI"/>
			</converter>
		</property-mapping>
		<property-mapping property="vehicle" column="VEHICLE"/>
		<property-mapping property="driverType" column="DRIVERTYPE"/>
		<property-mapping
			property="description" column="DESCRIPTION"/>						
		<reference-mapping reference="carrier">
			<reference-mapping-detail 
				column="CARRIER" 
				referenced-model-property="number"/> 
		</reference-mapping>							
		<property-mapping
			property="employee" column="EMPLOYEE"/>									
		<property-mapping
			property="remarks" column="REMARKS"/>									
		<property-mapping			
			property="incidents" column="INCIDENTS"/>																	
		<reference-mapping reference="shipment">
			<reference-mapping-detail 
				column="SHIPMENT_TYPE" 
				referenced-model-property="type"/> 
			<reference-mapping-detail 
				column="SHIPMENT_NUMBER" 
				referenced-model-property="number"/> 				
		</reference-mapping>							
			
	</entity-mapping>
	
</component>