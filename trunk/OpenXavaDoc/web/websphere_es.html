<p>OpenXava genera aplicaciones J2EE desplegables en <span
 style="font-style: italic;">IBM Websphere
Application Server 5.0, 5.1 y 6.0</span>.</p>
<p>Hacer esto simplemente requiere ejecutar una tarea ant que genera un
EAR compatible con Websphere, no es necesario que toquemos nuestro
c&oacute;digo Java ni nuestros archivos XML de ninguna manera.</p>
<p>Esto permite desarrollar la aplicaci&oacute;n usando JBoss (y por
ende de forma &aacute;gil) y cuando est&eacute; lista para
producci&oacute;n desplegarla en Websphere y por supuesto probarla a
fondo.</p>
En este documento se va dar una gu&iacute;a de como desplegar una
aplicaci&oacute;n OpenXava en Websphere. Si todav&iacute;a no tienes
ninguna es mejor que sigas primero el tutorial de OpenXava y as&iacute;
tendr&aacute;s <span style="font-family: monospace;">MiEscuela.ear</span>.<br>
<br>
Las siguientes instrucciones funcionan con Websphere 5.0, 5.1 y 6.0. En
el ejemplo nos conectamos a un AS/400, pero conectarse a cualquier otra
base de datos no tiene complicaci&oacute;n.<br>
<br>
Los pasos a dar son:<br>
<ul>
  <li><a href="#Crear_una_aplicacion_J2EE_compatible_con">Crear una
aplicaci&oacute;n J2EE compatible con Websphere.</a></li>
  <li><a href="#Instalar_Websphere">Instalar Websphere.</a></li>
  <li><a href="#Configurar_origenes_de_datos">Configurar origenes de
datos.</a></li>
  <li><a href="#Crear_tablas_en_la_base_de_datos">Crear tablas en la
base de datos.</a></li>
  <li><a href="#Instalar_aplicacion">Instalar aplicaci&oacute;n.</a></li>
  <li><a href="#Ejecutar_la_aplicacion">Ejecutar aplicaci&oacute;n.</a></li>
</ul>
<h4><a name="Crear_una_aplicacion_J2EE_compatible_con"></a>Crear una
aplicaci&oacute;n J2EE compatible con Websphere</h4>
Abre tu Eclipse y haz que apunte al <span style="font-style: italic;">workspace</span>
que viene con la
distribuci&oacute;n de OpenXava.&nbsp;<br>
<ul>
  <li>Edita <span style="font-family: monospace;">MiEscuela/build.xml</span>
y haz que la variable <span style="font-family: monospace;">configuration</span>
valga <span style="font-family: monospace;">websphere-as400</span>.</li>
  <li>Regenera c&oacute;digo, con la tarea ant <span
 style="font-style: italic;">MiEscuela.regenerarEJB</span>.</li>
  <li>Compilalo, pulsando <span style="font-style: italic;">Build</span>.</li>
  <li>Ejecuta la tarea ant <span style="font-style: italic;">MiEscuela.crearEarWebsphere</span>.</li>
</ul>
Y ya tienes en&nbsp;<span style="font-family: monospace;">MiEscuela.dist</span>
un archivo <span style="font-family: monospace;">MiEscuela.ear</span>
listo
para desplegarse en Websphere.
<h4><a name="Instalar_Websphere"></a>Instalar Websphere</h4>
Este paso corre de tu cuenta. Usando las instrucciones de IBM y como
buenamente puedas instalate el servidor de aplicaciones. Instalate
tambi&eacute;n el &uacute;ltimo nivel de parches disponibles.<br>
<h4><a name="Configurar_origenes_de_datos"></a>Configurar origenes de
datos</h4>
Abre la consola de administraci&oacute;n yendo a <a
 href="http://localhost:9090/admin">http://localhost:9090/admin</a> (o <a
 href="http://localhost:9060/admin">http://localhost:9060/admin</a> en
el caso de la versi&oacute;n 6).<br>
Primero tienes que crear una entrada J2C, que contiene un alias para un
usuario/contrase&ntilde;a que vamos a usar para autentificarnos frente
a nuestra base de datos:<br>
<ul>
  <li>En versi&oacute;n 5/5.1: Ve a <span style="font-style: italic;">Seguridad
&gt;
Configuraci&oacute;n de JAAS &gt; Datos de
autentificaci&oacute;n J2C</span>.</li>
  <li>En versi&oacute;n 6: Ve a<span style="font-style: italic;">
Security &gt; Global Security &gt; JAAS Configuration (on right)
&gt;&nbsp;J2C Authentication</span></li>
  <li>Pulsa <span style="font-style: italic;">Nuevo</span>.</li>
  <li>En el campo&nbsp;<span style="font-style: italic;">Alias</span>
pon&nbsp;<span style="font-family: monospace;">openxava</span> (u otro
que te guste m&aacute;s).</li>
  <li>En el campo&nbsp;<span style="font-style: italic;">Id de usuario</span>
pon el nombre de un usuario de tu base
de datos.</li>
  <li>En el campo&nbsp;<span style="font-style: italic;">Contrase&ntilde;a</span>
pon la contrase&ntilde;a de ese
usuario.</li>
  <li>Pulsa&nbsp;<span style="font-style: italic;">Aceptar</span>.</li>
  <li>Pulsa&nbsp;<span style="font-style: italic;">Guardar</span> que
te llevar&aacute; a otra p&aacute;gina en donde
tienes que pulsar un bot&oacute;n&nbsp;<span style="font-style: italic;">Guardar</span>.</li>
</ul>
Damos de alta el controlador JDBC:<br>
<ul>
  <li>Ve a <span style="font-style: italic;">Recursos &gt; Proveedores
JDBC</span>.</li>
  <li>Pulsa <span style="font-style: italic;">Nuevo</span>.</li>
  <li><span style="color: rgb(255, 0, 0);"></span>En versi&oacute;n
5/5.1</li>
  <ul>
    <li>En el campo&nbsp;<span style="font-style: italic;">Proveedores
JDBC</span> escoge <span style="font-style: italic;">DB2 UDB for
iSeries
(Toolbox XA)</span>, o el correspondiente a tu base de datos, pero la
versi&oacute;n XA.</li>
    <li>Pulsa&nbsp;<span style="font-style: italic;">Aplicar</span>.</li>
    <li>En el campo&nbsp;<span style="font-style: italic;">Classpath</span>
pon la ruta del controlador JDBC
(incluyendo el nombre del jar).</li>
    <li>Pulsa <span style="font-style: italic;">Aplicar</span>.</li>
  </ul>
  <li><span style="color: rgb(255, 0, 0);"></span>In version 6:</li>
  <ul>
    <li>Paso 1: Escoge DB2 (o el adecuado para tu base de datos).</li>
    <li>Paso 2: DB2 UDB for iSeries (Toolbox) (o el adecuado para tu
base de datos).</li>
    <li>Paso 3: Origen de datos XA (siempre este).</li>
    <li>Pulsa&nbsp;<span style="font-style: italic;">Siguiente</span>.</li>
    <li>En el campo&nbsp;<span style="font-style: italic;">Classpath</span>
pon la ruta del controlador JDBC
(incluyendo el nombre del jar).</li>
    <li>Pulsa <span style="font-style: italic;">Aplicar</span>.</li>
  </ul>
</ul>
Damos de alta el origen de datos de OpenXava:
<ul>
  <li>Pulsa en&nbsp;<span style="font-style: italic;">Origenes de datos</span>
(est&aacute; abajo del todo).</li>
  <li>Pulsa&nbsp;<span style="font-style: italic;">Nuevo</span>.</li>
  <li>En el campo&nbsp;<span style="font-style: italic;">Nombre</span>
pon&nbsp;<span style="font-family: monospace;">OpenXavaDS</span></li>
  <li>En el campo&nbsp;<span style="font-style: italic;">Nombre JNDI</span>
pon&nbsp;<span style="font-family: monospace;">jdbc/OpenXavaDS</span></li>
  <li>En el campo&nbsp;<span style="font-style: italic;">Alias de
autenticaci&oacute;n gestionado por
componentes</span> escoge&nbsp;<span style="font-style: italic;">xxxx/openxava</span>.</li>
  <li>En el campo&nbsp;<span style="font-style: italic;">Alias de
autenticaci&oacute;n gestionado por
contenedor</span> escoge&nbsp;<span style="font-style: italic;">xxxx/openxava</span>.</li>
  <li>En versi&oacute;n 5/5.1:</li>
  <ul>
    <li>Pulsa&nbsp;<span style="font-style: italic;">Aplicar</span>.</li>
    <li>Pulsa&nbsp;<span style="font-style: italic;">Propiedades
personalizadas</span>, esto te lleva a otra
p&aacute;gina.</li>
    <li>Pulsa&nbsp;<span style="font-style: italic;">serverName</span>&nbsp;
y en el campo&nbsp;<span style="font-style: italic;">Valor</span> pon
la IP de tu
AS/400 (esto solo para AS/400).</li>
    <li>Pulsa&nbsp;<span style="font-style: italic;">Aceptar</span>.</li>
  </ul>
  <li>In versi&oacute;n 6:</li>
  <ul>
    <li>En el campo <span style="font-style: italic;">serverName</span>&nbsp;pon
la IP de tu
AS/400 (esto solo para AS/400).</li>
    <li>Pulsa&nbsp;<span style="font-style: italic;">Aceptar</span>.</li>
  </ul>
</ul>
Damos de alta el origen de datos para tu aplicaci&oacute;n:
<ul>
  <li>Ve a&nbsp;<span style="font-style: italic;">Origines de datos</span>.</li>
  <li>Pulsa&nbsp;<span style="font-style: italic;">Nuevo</span>.</li>
  <li>En el campo&nbsp;<span style="font-style: italic;">Nombre</span>
pon <span style="font-family: monospace;">MySchoolDS</span></li>
  <li>En el campo&nbsp;<span style="font-style: italic;">Nombre JNDI</span>
pon <span style="font-family: monospace;">jdbc/MySchoolDS</span></li>
  <li>Marca la casilla de chequeo de&nbsp;<span
 style="font-style: italic;">Persistencia gestionada por
contenedor</span>.</li>
  <li>En el campo&nbsp;<span style="font-style: italic;">Alias de
autenticaci&oacute;n gestionado por
componentes</span> escoge&nbsp;<span style="font-style: italic;">xxxx/openxava</span>.</li>
  <li>En el campo&nbsp;<span style="font-style: italic;">Alias de
autenticaci&oacute;n gestionado por
contenedor</span> escoge&nbsp;<span style="font-style: italic;">xxxx/openxava</span>.</li>
  <li>En versi&oacute;n 5/5.1:</li>
  <ul>
    <li>Pulsa&nbsp;<span style="font-style: italic;">Aplicar</span>.</li>
    <li>Pulsa&nbsp;<span style="font-style: italic;">Propiedades
personalizadas</span>, esto te lleva a otra
p&aacute;gina.</li>
    <li>Pulsa&nbsp;<span style="font-style: italic;">serverName</span>&nbsp;
y en el campo&nbsp;<span style="font-style: italic;">Valor</span> pon
la IP de tu
AS/400 (esto solo para AS/400).</li>
    <li>Pulsa&nbsp;<span style="font-style: italic;">Aceptar</span>.</li>
  </ul>
  <li>In versi&oacute;n 6:</li>
  <ul>
    <li>En el campo <span style="font-style: italic;">serverName</span>&nbsp;pon
la IP de tu
AS/400 (esto solo para AS/400).</li>
    <li>Pulsa&nbsp;<span style="font-style: italic;">Aceptar</span>.</li>
  </ul>
  <li>Pulsa&nbsp;<span style="font-style: italic;">Guardar</span> que
te lleva a otra p&aacute;gina y ah&iacute;
pulsa el bot&oacute;n&nbsp;<span style="font-style: italic;">Guardar</span>
que est&aacute; abajo.</li>
</ul>
Comprobamos los origines de datos:<br>
<ul>
  <li>Ve a <span style="font-style: italic;">Recursos &gt; Proveedores
JDBC</span>.</li>
  <li>Pulsa&nbsp;<span style="font-style: italic;">DB2 UDB for iSeries</span>.</li>
  <li>Pulsa en&nbsp;<span style="font-style: italic;">Origines de datos</span>
(est&aacute; abajo del todo).</li>
  <li>Selecciona las 2 que acabas de crear.</li>
  <li>Pulsa el bot&oacute;n&nbsp;<span style="font-style: italic;">Conexi&oacute;n
de prueba</span>.</li>
</ul>
Si el mensaje es satisfactorio hemos concluido bien este paso.<br>
<h4><a name="Crear_tablas_en_la_base_de_datos"></a>Crear tablas en la
base de datos</h4>
Ejecuta el siguiente script contra tu DB:<br>
<pre>CREATE COLLECTION OPENXAVA;<br><br>CREATE TABLE OPENXAVA.TABUSERPREFERENCES<br>	(OID INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 0) NOT NULL PRIMARY KEY,<br>	USER VARCHAR(20),<br>	TAB VARCHAR(100),<br>	PROPERTIESNAMES VARCHAR(512));<br>	<br>CREATE INDEX OPENXAVA.TABUSERPREFERENCES01 <br>	ON OPENXAVA.TABUSERPREFERENCES(USER,TAB);<br><br>CREATE COLLECTION MYSCHOOL;</pre>
<pre>CREATE TABLE MYSCHOOL.TEACHER(ID VARCHAR(5) NOT NULL PRIMARY KEY,NAME<br>VARCHAR(40));</pre>
<pre>CREATE TABLE MYSCHOOL.PUPIL(NUMBER INTEGER NOT NULL PRIMARY KEY,NAME<br>VARCHAR(40),TEACHER VARCHAR(5));</pre>
<pre>INSERT INTO MYSCHOOL.TEACHER VALUES('JP','FRANCISCO JAVIER PANIZA<br>LUCAS');</pre>
<pre>INSERT INTO MYSCHOOL.TEACHER VALUES('MC','M. CARMEN GIMENO ALABAU');</pre>
<pre>INSERT INTO MYSCHOOL.PUPIL VALUES(1,'LARS',NULL);</pre>
<pre>INSERT INTO MYSCHOOL.PUPIL VALUES(2,'ANA','JP');</pre>
<pre>INSERT INTO MYSCHOOL.PUPIL VALUES(3,'LUIS MIGUEL','JP');</pre>
<pre>INSERT INTO MYSCHOOL.PUPIL VALUES(4,'MIGUEL',NULL);</pre>
<h4><a name="Instalar_aplicacion"></a>Instalar aplicaci&oacute;n</h4>
Para instalar la aplicaci&oacute;n:<br>
<ul>
  <li>Ve a <span style="font-style: italic;">Aplicaciones &gt;
Aplicaciones de empresa</span>.</li>
  <li>Pulsa&nbsp;<span style="font-style: italic;">Instalar</span>.</li>
  <li>Pulsa&nbsp;<span style="font-style: italic;">Examinar</span> en
el campo&nbsp;<span style="font-style: italic;">V&iacute;a de acceso
local</span>, y
buscar el ear de tu aplicaci&oacute;n.</li>
  <li>Pulsa&nbsp;<span style="font-style: italic;">Siguiente</span>.</li>
  <li>Pulsa&nbsp;<span style="font-style: italic;">Siguiente</span>.</li>
  <li>Pulsa&nbsp;<span style="font-style: italic;">Continuar</span>.</li>
  <li>Paso 1: Pulsa&nbsp;<span style="font-style: italic;">Siguiente</span>.</li>
  <li>En version 5/5.1:</li>
  <ul>
    <li>Paso 2: Escoge&nbsp;<span style="font-style: italic;">DB2UDBISERIES</span>
o el corersponda a tu DB y pulsa&nbsp;<span style="font-style: italic;">Siguiente</span>.</li>
  </ul>
  <li>En version 6:</li>
  <ul>
    <li>Paso 2: Pulsa <span style="font-style: italic;">Siguiente</span>.</li>
    <li>Paso 3:&nbsp;Escoge&nbsp;<span style="font-style: italic;">DB2UDBISERIES</span>
o el corersponda a tu DB y pulsa&nbsp;<span style="font-style: italic;">Siguiente</span>.</li>
    <li>Step 6: Aparece un mensaje de advertencia. Pulsa <span
 style="font-style: italic;">Continuar</span>.</li>
    <li>Step 8:&nbsp;Aparece un mensaje de advertencia. Pulsa <span
 style="font-style: italic;">Continuar</span>.</li>
  </ul>
  <li>En los dem&aacute;s pasos pulsa&nbsp;<span
 style="font-style: italic;">Siguiente</span>, hasta que aparezca&nbsp;<span
 style="font-style: italic;">Finalizar</span>, pulsalo tambi&eacute;n.</li>
  <li>Paciencia, a esperar mientras despliega...</li>
  <li>Pulsar&nbsp;<span style="font-style: italic;">Gestionar
aplicaciones</span>.</li>
  <li>Pulsar en&nbsp;<span style="font-style: italic;">MiEscuela</span>.</li>
  <li>En&nbsp;<span style="font-style: italic;">Pol&iacute;tica del
cargador de clases WAR</span> &nbsp;escoger&nbsp;<span
 style="font-style: italic;">Aplicaci&oacute;n</span>.</li>
  <li>Pulsar&nbsp;<span style="font-style: italic;">Aplicar</span>.</li>
  <li>Pulsar&nbsp;<span style="font-style: italic;">M&oacute;dulos Web</span>
(est&aacute; abajo del todo).</li>
  <li>Pulsar&nbsp;<span style="font-style: italic;">MiEscuela.war</span>.</li>
  <li>En el campo&nbsp;<span style="font-style: italic;">Modalidad de
cargador de clases</span> poner&nbsp;<span style="font-style: italic;">PADRE_&Uacute;LTIMO</span>.</li>
  <li>Pulsar&nbsp;<span style="font-style: italic;">Aceptar</span>.</li>
  <li>Pulsa&nbsp;<span style="font-style: italic;">Guardar</span> que
te lleva a otra p&aacute;gina y ah&iacute;
pulsa el bot&oacute;n&nbsp;<span style="font-style: italic;">Guardar</span>
que est&aacute; abajo.</li>
</ul>
<h4><a name="Ejecutar_la_aplicacion"></a>Ejecutar la aplicaci&oacute;n</h4>
Ya est&aacute; todo lista para que ejecutes tu aplicaci&oacute;n en
Websphere:<br>
<ul>
  <li>Ve a <span style="font-style: italic;">Aplicaciones &gt;
Aplicaciones de empresa</span>.</li>
  <li>Selecciona la aplicaci&oacute;n <span style="font-style: italic;">MiEscuela</span>.</li>
  <li>Pulsa <span style="font-style: italic;">Iniciar</span>.</li>
  <li>Con tu navegador de internet ve a la direcci&oacute;n <a
 href="http://localhost:9080/MiEscuela/xava/module.jsp?application=MiEscuela&amp;module=Profesores">http://localhost:9080/MiEscuela/xava/module.jsp?application=MiEscuela&amp;module=Profesores</a>.</li>
  <li>Prueba la aplicaci&oacute;n.</li>
</ul>
Tambi&eacute;n&nbsp;puedes lanzar la prueba JUnit, en tu Eclipse:<br>
<ul>
  <li>Edita <span style="font-family: monospace;">MiEscuela/properties/xava-junit.properties</span>.</li>
  <li>Cambia <span style="font-family: monospace;">port=8080</span>
por <span style="font-family: monospace;">port=9080</span>.</li>
  <li>Ejecuta la prueba JUnit <span style="font-family: monospace;">PruebaProfesores</span>.rTesT</li>
</ul>
