<?xml version="1.0"?>
<tl>&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
<declare import="org.openxava.component.MetaComponent"/>
<declare import="org.openxava.generators.Generators"/>
<declare import="org.openxava.util.*"/>
<declare import="org.openxava.model.meta.*"/>
<declare import="org.openxava.mapping.*"/>

&lt;!-- Generated by OpenXava: <expr>new Date()</expr> --&gt;
<java>
String componentName = properties.getProperty("arg3");
String aggregateName = properties.getProperty("arg4");
MetaComponent component = MetaComponent.get(componentName);
ModelMapping mapping = null;
if (aggregateName == null) {
	mapping = component.getEntityMapping();	
}
else {
	mapping = component.getAggregateMapping(aggregateName);	
}
String tableId = Strings.change(mapping.getTable(), ".", "_");
String table = mapping.getUnqualifiedTable();
String schema = mapping.getSchema();
String pk = table + "PK";
String pkMembers = mapping.getKeyColumnsAsString();
if (schema == null) {
	throw new XavaException("websphere_schema_required", componentName);
}
</java> 

&lt;RDBSchema:RDBTable xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:RDBSchema="RDBSchema.xmi" xmi:id="<expr>tableId</expr>" name="<expr>table</expr>" primaryKey="<expr>pk</expr>"&gt;
  &lt;database href="META-INF/backends/OPENXAVA/DB.dbxmi#DB"/&gt;
  &lt;schema href="META-INF/backends/OPENXAVA/<expr>schema</expr>.schxmi#<expr>schema</expr>"/&gt;
<java>
for (Iterator it=mapping.getCmpFields().iterator(); it.hasNext();) {
	CmpField field = (CmpField) it.next();
	String cmpTypeName = field.getCmpTypeName();
	if (Is.emptyString(cmpTypeName)) {
		throw new XavaException("unknow_type", field.getCmpPropertyName(), mapping.getModelName());
	}
	String type = Generators.getWebsphereSQLType(cmpTypeName, false);
	String href = Generators.getWebsphereSQLType(cmpTypeName, true);
</java> 
  &lt;columns xmi:type="RDBSchema:RDBColumn" xmi:id="<expr>field.getColumn()</expr>" name="<expr>field.getColumn()</expr>"&gt;
    &lt;type xmi:type="<expr>type</expr>" xmi:id="<expr>type</expr>_<expr>field</expr>"&gt;
      &lt;originatingType xmi:type="<expr>type</expr>" href="<expr>href</expr>"/&gt;
    &lt;/type&gt;
  &lt;/columns&gt;
<java>
}
</java> 
  &lt;namedGroup xmi:type="RDBSchema:SQLReference" xmi:id="<expr>pk</expr>" name="<expr>pk</expr>" members="<expr>pkMembers</expr>" constraint="SQLConstraint_<expr>pk</expr>"/&gt;
  &lt;constraints xmi:id="SQLConstraint_<expr>pk</expr>" name="<expr>pk</expr>" type="PRIMARYKEY" primaryKey="<expr>pk</expr>"/&gt;
&lt;/RDBSchema:RDBTable&gt;
</tl>